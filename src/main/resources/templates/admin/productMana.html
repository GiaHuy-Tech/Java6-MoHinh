<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin | Quản lý sản phẩm</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
    --bg-main:#050b14;
    --bg-card:#0c1525;
    --neon:#00f2ff;
    --border:rgba(0,242,255,.35);
    --text:#e6ecff;
}
body{
    background:linear-gradient(135deg,#050b14,#14002b);
    color:var(--text);
    font-family:"Be Vietnam Pro",sans-serif;
}
.card{
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:14px;
}
.card-header{
    background:rgba(0,242,255,.08);
    color:var(--neon);
    font-family:"Orbitron",sans-serif;
    letter-spacing:.5px;
}
.form-control,.form-select{
    background:rgba(0,0,0,.45)!important;
    color:#fff!important;
    border:1px solid var(--border);
}
.form-control:focus,.form-select:focus{
    border-color:var(--neon);
    box-shadow:0 0 0 .15rem rgba(0,242,255,.25);
}
.form-label{
    color:var(--neon);
    font-weight:600;
}
.table{
    --bs-table-bg:transparent;
    --bs-table-color:var(--text);
}
.btn-neon{
    color:var(--neon);
    border:1px solid var(--neon);
}
.btn-neon:hover{
    background:var(--neon);
    color:#000;
}
.badge{
    font-size:.85rem;
}
img.thumb{
    width:60px;
    height:60px;
    object-fit:cover;
    border-radius:8px;
    border:1px solid var(--border);
}
</style>
</head>

<body>
<div class="container py-5">

<!-- ================= DANH SÁCH ================= -->
<div class="card mb-5">
    <div class="card-header">Danh sách sản phẩm</div>
    <div class="card-body p-0">
        <table class="table table-hover text-center align-middle mb-0">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ảnh</th>
                    <th class="text-start">Tên</th>
                    <th>Giá</th>
                    <th>Cân nặng</th>
                    <th>Danh mục</th>
                    <th>Trạng thái</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="p : ${list}">
                    <td th:text="${p.id}"></td>
                    <td>
                        <img th:src="@{${p.image != null ? p.image : '/images/no-image.png'}}"
                             class="thumb">
                    </td>
                    <td th:text="${p.name}" class="text-start fw-semibold"></td>
                    <td th:text="${#numbers.formatInteger(p.price,0,'POINT')} + ' ₫'"></td>
                    <td th:text="${p.weight} + ' kg'"></td>
                    <td th:text="${p.category != null ? p.category.name : '---'}"></td>
                    <td>
                        <span th:if="${p.available}" class="badge bg-success">Còn hàng</span>
                        <span th:unless="${p.available}" class="badge bg-danger">Hết hàng</span>
                    </td>
                    <td>
                        <a th:href="@{/product-mana/edit/{id}(id=${p.id})}"
                           class="btn btn-sm btn-neon">
                           <i class="bi bi-pencil-square"></i> Sửa
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- ================= FORM ADD ================= -->
<form th:if="${product.id == null}"
      th:action="@{/product-mana/add}"
      th:object="${product}"
      method="post"
      enctype="multipart/form-data">

<div class="card mb-5">
<div class="card-header">Thêm sản phẩm</div>
<div class="card-body row g-3">

<div class="col-md-4">
    <label class="form-label">Tên sản phẩm</label>
    <input th:field="*{name}" class="form-control">
</div>

<div class="col-md-2">
    <label class="form-label">Giá</label>
    <input th:field="*{price}" type="number" class="form-control">
</div>

<div class="col-md-2">
    <label class="form-label">Cân nặng (kg)</label>
    <input th:field="*{weight}" type="number" step="0.1" class="form-control" value="0.5">
</div>

<div class="col-md-4">
    <label class="form-label">Danh mục</label>
    <select th:field="*{category.id}" class="form-select">
        <option th:each="c:${categories}" th:value="${c.id}" th:text="${c.name}"></option>
    </select>
</div>

<div class="col-md-3">
    <label class="form-label">Trạng thái</label>
    <select th:field="*{available}" class="form-select">
        <option th:value="true">Còn hàng</option>
        <option th:value="false">Hết hàng</option>
    </select>
</div>

<div class="col-md-6">
    <label class="form-label">Ảnh sản phẩm</label>
    <input type="file" name="imageFiles" multiple class="form-control">
</div>

<div class="col-md-3">
    <label class="form-label">Index ảnh chính</label>
    <input type="number" name="thumbnailIndex" value="0" class="form-control">
</div>

<div class="text-end">
    <button class="btn btn-neon px-5">
        <i class="bi bi-save"></i> Lưu
    </button>
</div>

</div>
</div>
</form>

<!-- ================= FORM UPDATE ================= -->
<form th:if="${product.id != null}"
      th:action="@{/product-mana/update}"
      th:object="${product}"
      method="post"
      enctype="multipart/form-data">

<input type="hidden" th:field="*{id}">

<div class="card border-warning">
<div class="card-header text-warning">Cập nhật sản phẩm</div>
<div class="card-body row g-3">

<div class="col-md-4">
    <label class="form-label">Tên sản phẩm</label>
    <input th:field="*{name}" class="form-control">
</div>

<div class="col-md-2">
    <label class="form-label">Giá</label>
    <input th:field="*{price}" type="number" class="form-control">
</div>

<div class="col-md-2">
    <label class="form-label">Cân nặng (kg)</label>
    <input th:field="*{weight}" type="number" step="0.1" class="form-control">
</div>

<div class="col-md-4">
    <label class="form-label">Danh mục</label>
    <select th:field="*{category.id}" class="form-select">
        <option th:each="c:${categories}" th:value="${c.id}" th:text="${c.name}"></option>
    </select>
</div>

<div class="col-md-3">
    <label class="form-label">Trạng thái</label>
    <select th:field="*{available}" class="form-select">
        <option th:value="true">Còn hàng</option>
        <option th:value="false">Hết hàng</option>
    </select>
</div>

<div class="col-md-12">
    <label class="form-label">Ảnh hiện tại</label>
    <div class="d-flex gap-2 flex-wrap">
        <img th:each="img:${product.images}"
             th:src="@{${img.image}}"
             class="thumb">
    </div>
</div>

<div class="col-md-6">
    <label class="form-label">Thêm ảnh mới</label>
    <input type="file" name="imageFiles" multiple class="form-control">
</div>

<div class="col-md-3">
    <label class="form-label">Index ảnh chính</label>
    <input type="number" name="thumbnailIndex" value="0" class="form-control">
</div>

<div class="text-end">
    <a th:href="@{/product-mana}" class="btn btn-secondary me-2">Hủy</a>
    <button class="btn btn-warning px-5">
        <i class="bi bi-arrow-repeat"></i> Cập nhật
    </button>
</div>

</div>
</div>
</form>

</div>
</body>
</html>
